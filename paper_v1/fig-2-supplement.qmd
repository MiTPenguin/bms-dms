---
title: "TYK2 Analysis - Supplementary Figure 2"
author: "Nathan Abell and Robert Warneford-Thomson"
format: gfm
code-fold: true
knitr:
  opts_chunk:
    fig.align: "center"
---

```{r fig.height=15, fig.width=8}
#| label: fig-2-supplement-setup
#| echo: false
#| warning: false
#| message: false

cbPalette <- c("#DC5E65", "#E69F00", "#56B4E9",
  "#0072B2", "darkgrey", "#009E73", 
  "#F0E442", "pink", "#CC79A7",
  "lightgrey", "grey")

aa_order <- c("*", "P", "G", "A", "M",
  "V", "L", "I", "T", "S",
  "C", "Q", "N", "Y", "W",
  "F", "E", "D", "K", "H", "R")

ifna_series <- bind_rows(
  contrast_sumstats %>% filter(condition == "IFNalpha100_0", assay == "assay3") %>% mutate(condition = "IFNa 100 U/mL"),
  contrast_sumstats %>% filter(condition == "IFNalpha_10", assay == "assay1") %>% mutate(condition = "IFNa 10 U/mL"),
  contrast_sumstats %>% filter(condition == "IFNalpha_1", assay == "assay1") %>% mutate(condition = "IFNa 1 U/mL")
) %>% select(pos, condition, aa, statistic_contrast) %>%
  rename("statistic" = "statistic_contrast")

flow_series <- read_tsv("../sumstats/TYK2-vamp2.midpoints.tsv", show_col_types = FALSE) %>%
    mutate(aa = if_else(aa %in% c("X", "Stop", "*"), "*", aa),
           aa = factor(aa, levels = aa_order)) %>% 
  select(pos, aa, statistic) %>%
  mutate(condition = "Abundance")

fig_data <- bind_rows(ifna_series, flow_series) %>%
  mutate(aa = if_else(aa %in% c("*", "Stop", "X"), "*", aa),
    aa = factor(aa, levels = aa_order),
    condition = factor(condition, levels = c("IFNa 1 U/mL",
      "IFNa 10 U/mL",
      "IFNa 100 U/mL",
      "Abundance")))

supp_fig_2 <- fig_data %>% 
  ggplot() +
    geom_tile(aes(x = pos, y = aa, fill = statistic)) +
    scale_fill_scico_mid("Z statistic", limits = c(-10, 2.5),
      palette = "vik", mid = 0,
      oob = scales::squish) +
    scale_x_continuous(breaks = seq(0, 1000, by = 250),
      expand = c(0, 0)) +
    ylab("") +
    xlab("TYK2 Amino Acid Position") +
    custom_theme +
    facet_wrap(~condition, ncol = 1)

supp_fig_2
```
